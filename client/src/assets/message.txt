-- CreateTable
CREATE TABLE "USER" (
    "id" SERIAL NOT NULL,
    "username" TEXT NOT NULL,
    "email" TEXT NOT NULL,
    "password" TEXT NOT NULL,
    "name" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    CONSTRAINT "USER_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "INTERSECTION" (
    "id" SERIAL NOT NULL,
    "name" TEXT NOT NULL,
    "sector" INTEGER NOT NULL,
    "lat" DOUBLE PRECISION,
    "lng" DOUBLE PRECISION,

    CONSTRAINT "INTERSECTION_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "SEMAPHOR" (
    "id" SERIAL NOT NULL,
    "type" TEXT NOT NULL,
    "street" TEXT NOT NULL,
    "sense" TEXT NOT NULL,
    "intersectionId" INTEGER NOT NULL,

    CONSTRAINT "SEMAPHOR_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "BUS_STATION" (
    "id" SERIAL NOT NULL,
    "name" TEXT NOT NULL,
    "sense" TEXT NOT NULL,
    "no_people" INTEGER NOT NULL,
    "no_buses" INTEGER NOT NULL,
    "intersectionId" INTEGER NOT NULL,

    CONSTRAINT "BUS_STATION_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "TRAM_STATION" (
    "id" SERIAL NOT NULL,
    "name" TEXT NOT NULL,
    "sense" TEXT NOT NULL,
    "no_people" INTEGER NOT NULL,
    "no_trams" INTEGER NOT NULL,
    "intersectionId" INTEGER NOT NULL,

    CONSTRAINT "TRAM_STATION_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "TROLEIBUS_STATION" (
    "id" SERIAL NOT NULL,
    "name" TEXT NOT NULL,
    "sense" TEXT NOT NULL,
    "no_people" INTEGER NOT NULL,
    "no_troleibuses" INTEGER NOT NULL,
    "intersectionId" INTEGER NOT NULL,

    CONSTRAINT "TROLEIBUS_STATION_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "CAR" (
    "id" SERIAL NOT NULL,
    "color" TEXT NOT NULL,
    "regNr" TEXT NOT NULL,

    CONSTRAINT "CAR_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "BUS" (
    "id" SERIAL NOT NULL,
    "regNr" TEXT NOT NULL,
    "line" TEXT NOT NULL,

    CONSTRAINT "BUS_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "TRAM" (
    "id" SERIAL NOT NULL,
    "regNr" TEXT NOT NULL,
    "line" TEXT NOT NULL,

    CONSTRAINT "TRAM_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "TROLEIBUS" (
    "id" SERIAL NOT NULL,
    "regNr" TEXT NOT NULL,
    "line" TEXT NOT NULL,

    CONSTRAINT "TROLEIBUS_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "PERSON" (
    "id" SERIAL NOT NULL,
    "gender" TEXT NOT NULL,

    CONSTRAINT "PERSON_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "CROSSING_CAR" (
    "id" SERIAL NOT NULL,
    "speed" DOUBLE PRECISION,
    "timestamp" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "semaphorId" INTEGER NOT NULL,
    "carId" INTEGER NOT NULL,

    CONSTRAINT "CROSSING_CAR_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "CROSSING_BUS" (
    "id" SERIAL NOT NULL,
    "speed" DOUBLE PRECISION,
    "timestamp" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "semaphorId" INTEGER NOT NULL,
    "busId" INTEGER NOT NULL,

    CONSTRAINT "CROSSING_BUS_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "CROSSING_TRAM" (
    "id" SERIAL NOT NULL,
    "speed" DOUBLE PRECISION,
    "timestamp" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "semaphorId" INTEGER NOT NULL,
    "tramId" INTEGER NOT NULL,

    CONSTRAINT "CROSSING_TRAM_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "CROSSING_TROLEIBUS" (
    "id" SERIAL NOT NULL,
    "speed" DOUBLE PRECISION,
    "timestamp" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "semaphorId" INTEGER NOT NULL,
    "troleibusId" INTEGER NOT NULL,

    CONSTRAINT "CROSSING_TROLEIBUS_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "CROSSING_PERSON" (
    "id" SERIAL NOT NULL,
    "timestamp" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "semaphorId" INTEGER NOT NULL,
    "personId" INTEGER NOT NULL,

    CONSTRAINT "CROSSING_PERSON_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "STOPPED_BUS" (
    "id" SERIAL NOT NULL,
    "stoppedMinutes" INTEGER NOT NULL,
    "expectedArrival" TIMESTAMP(3) NOT NULL,
    "actualArrival" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "busId" INTEGER NOT NULL,
    "stationId" INTEGER NOT NULL,

    CONSTRAINT "STOPPED_BUS_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "STOPPED_TRAM" (
    "id" SERIAL NOT NULL,
    "stoppedMinutes" INTEGER NOT NULL,
    "expectedArrival" TIMESTAMP(3) NOT NULL,
    "actualArrival" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "tramId" INTEGER NOT NULL,
    "stationId" INTEGER NOT NULL,

    CONSTRAINT "STOPPED_TRAM_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "STOPPED_TROLEIBUS" (
    "id" SERIAL NOT NULL,
    "stoppedMinutes" INTEGER NOT NULL,
    "expectedArrival" TIMESTAMP(3) NOT NULL,
    "actualArrival" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "troleibusId" INTEGER NOT NULL,
    "stationId" INTEGER NOT NULL,

    CONSTRAINT "STOPPED_TROLEIBUS_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "CHANGING" (
    "id" SERIAL NOT NULL,
    "color" TEXT NOT NULL,
    "timestamp" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "semaphorId" INTEGER NOT NULL,

    CONSTRAINT "CHANGING_pkey" PRIMARY KEY ("id")
);

-- CreateIndex
CREATE UNIQUE INDEX "USER_username_key" ON "USER"("username");

-- CreateIndex
CREATE UNIQUE INDEX "USER_email_key" ON "USER"("email");

-- CreateIndex
CREATE UNIQUE INDEX "CAR_regNr_key" ON "CAR"("regNr");

-- CreateIndex
CREATE UNIQUE INDEX "BUS_regNr_key" ON "BUS"("regNr");

-- CreateIndex
CREATE UNIQUE INDEX "TRAM_regNr_key" ON "TRAM"("regNr");

-- CreateIndex
CREATE UNIQUE INDEX "TROLEIBUS_regNr_key" ON "TROLEIBUS"("regNr");

-- AddForeignKey
ALTER TABLE "SEMAPHOR" ADD CONSTRAINT "SEMAPHOR_intersectionId_fkey" FOREIGN KEY ("intersectionId") REFERENCES "INTERSECTION"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "BUS_STATION" ADD CONSTRAINT "BUS_STATION_intersectionId_fkey" FOREIGN KEY ("intersectionId") REFERENCES "INTERSECTION"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "TRAM_STATION" ADD CONSTRAINT "TRAM_STATION_intersectionId_fkey" FOREIGN KEY ("intersectionId") REFERENCES "INTERSECTION"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "TROLEIBUS_STATION" ADD CONSTRAINT "TROLEIBUS_STATION_intersectionId_fkey" FOREIGN KEY ("intersectionId") REFERENCES "INTERSECTION"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "CROSSING_CAR" ADD CONSTRAINT "CROSSING_CAR_semaphorId_fkey" FOREIGN KEY ("semaphorId") REFERENCES "SEMAPHOR"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "CROSSING_CAR" ADD CONSTRAINT "CROSSING_CAR_carId_fkey" FOREIGN KEY ("carId") REFERENCES "CAR"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "CROSSING_BUS" ADD CONSTRAINT "CROSSING_BUS_semaphorId_fkey" FOREIGN KEY ("semaphorId") REFERENCES "SEMAPHOR"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "CROSSING_BUS" ADD CONSTRAINT "CROSSING_BUS_busId_fkey" FOREIGN KEY ("busId") REFERENCES "BUS"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "CROSSING_TRAM" ADD CONSTRAINT "CROSSING_TRAM_semaphorId_fkey" FOREIGN KEY ("semaphorId") REFERENCES "SEMAPHOR"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "CROSSING_TRAM" ADD CONSTRAINT "CROSSING_TRAM_tramId_fkey" FOREIGN KEY ("tramId") REFERENCES "TRAM"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "CROSSING_TROLEIBUS" ADD CONSTRAINT "CROSSING_TROLEIBUS_semaphorId_fkey" FOREIGN KEY ("semaphorId") REFERENCES "SEMAPHOR"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "CROSSING_TROLEIBUS" ADD CONSTRAINT "CROSSING_TROLEIBUS_troleibusId_fkey" FOREIGN KEY ("troleibusId") REFERENCES "TROLEIBUS"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "CROSSING_PERSON" ADD CONSTRAINT "CROSSING_PERSON_semaphorId_fkey" FOREIGN KEY ("semaphorId") REFERENCES "SEMAPHOR"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "CROSSING_PERSON" ADD CONSTRAINT "CROSSING_PERSON_personId_fkey" FOREIGN KEY ("personId") REFERENCES "PERSON"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "STOPPED_BUS" ADD CONSTRAINT "STOPPED_BUS_busId_fkey" FOREIGN KEY ("busId") REFERENCES "BUS"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "STOPPED_BUS" ADD CONSTRAINT "STOPPED_BUS_stationId_fkey" FOREIGN KEY ("stationId") REFERENCES "BUS_STATION"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "STOPPED_TRAM" ADD CONSTRAINT "STOPPED_TRAM_tramId_fkey" FOREIGN KEY ("tramId") REFERENCES "TRAM"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "STOPPED_TRAM" ADD CONSTRAINT "STOPPED_TRAM_stationId_fkey" FOREIGN KEY ("stationId") REFERENCES "TRAM_STATION"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "STOPPED_TROLEIBUS" ADD CONSTRAINT "STOPPED_TROLEIBUS_troleibusId_fkey" FOREIGN KEY ("troleibusId") REFERENCES "TROLEIBUS"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "STOPPED_TROLEIBUS" ADD CONSTRAINT "STOPPED_TROLEIBUS_stationId_fkey" FOREIGN KEY ("stationId") REFERENCES "TROLEIBUS_STATION"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "CHANGING" ADD CONSTRAINT "CHANGING_semaphorId_fkey" FOREIGN KEY ("semaphorId") REFERENCES "SEMAPHOR"("id") ON DELETE CASCADE ON UPDATE CASCADE;
 rewrite in sql/mariadb